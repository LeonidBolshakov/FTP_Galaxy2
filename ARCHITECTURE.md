# ARCHITECTURE.md

## Общая архитектура проекта

Проект построен на принципах чистой архитектуры и явного внедрения зависимостей.
Основная цель — обеспечить слабую связность компонентов, прозрачные границы ответственности
и возможность замены реализаций без изменения бизнес-логики.

---

## Слои архитектуры

Архитектура условно разделена на следующие слои:

### 1. Domain (ядро)

Содержит:
- доменные модели (DTO, Value Objects)
- перечисления (Enum)
- чистую бизнес-логику
- типы данных, не зависящие от инфраструктуры

---

### 2. Protocols (контракты)

Содержит:
- `typing.Protocol`, описывающие роли компонентов

Примеры:
- `SnapshotService`
- `DiffPlanner`
- `TransferService`
- `ExecutionPolicy`
- `RepositoryValidator`
- `ErrorHandler`

---

### 3. Implementations (реализации)

Содержит:
- конкретные классы, реализующие протоколы
- `DefaultX` и альтернативные реализации

---

### 4. Application / Controller

Содержит:
- оркестрацию сценариев
- управление жизненным циклом выполнения

---

### 5. Infrastructure

Содержит:
- логирование
- загрузку конфигурации
- работу с файловой системой
- внешние сервисы

---

## Dependency Injection

Внедрение зависимостей происходит в точке входа (`main.py`)
и всегда через протоколы.

---

## Принципы

- один класс — одна ответственность
- отсутствие скрытых зависимостей
- Protocol — только для контрактов
- контроллер не знает реализаций
